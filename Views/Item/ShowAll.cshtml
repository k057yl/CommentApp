@model IEnumerable<CommentApp.Models.Entities.Item>

@{
    ViewData["Title"] = "Все посты";
}

<h1>Все посты</h1>

@foreach (var item in Model)
{
    <div class="post">
        <a class="btn btn-secondary" asp-action="Details" asp-controller="Item" asp-route-id="@item.ItemId">@item.Name</a>
        <p>@item.Text</p>
        <p><strong>@item.User.UserName</strong> | @item.CreationDate.ToString("dd.MM.yyyy HH:mm")</p>

        <h4>Комментарии:</h4>
        @if (item.Comments.Any())
        {
            <ul>
                @foreach (var comment in item.Comments)
                {
                    <li>                        
                        <strong>@comment.User.UserName</strong> (@comment.CreationDate.ToString("dd.MM.yyyy HH:mm")): @comment.Text
                        @if (comment.Replies.Any())
                        {
                            <ul>
                                @foreach (var reply in comment.Replies)
                                {
                                    <li>
                                        <strong>@reply.User.UserName</strong> (@reply.CreationDate.ToString("dd.MM.yyyy HH:mm")): @reply.Text
                                    </li>
                                }
                            </ul>
                        }
                    </li>
                }
            </ul>
        }
        else
        {
            <p>Нет комментариев</p>
        }

        <form asp-action="AddComment" asp-controller="Message" method="post">
            <input type="hidden" name="itemId" value="@item.ItemId" />
            <textarea name="text" required placeholder="Напишите ваш комментарий..."></textarea>
            <button type="submit">Добавить комментарий</button>
        </form>
    </div>
}