<div class="form-wrapper">
  <form [formGroup]="commentForm" (ngSubmit)="onSubmit()" class="modern-form">
    <div class="user-info">
      <div class="mini-avatar">{{ commentForm.getRawValue().userName[0] }}</div>
      <span>–ü–∏—Å–∞—Ç—å –∫–∞–∫ <strong>{{ commentForm.getRawValue().userName }}</strong></span>
    </div>

    <div class="textarea-section">
      <textarea formControlName="text" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
      
      <div class="attachment-bar">
        <div class="file-buttons">
          <label class="attach-btn">
            <input type="file" (change)="onFileSelected($event, 'image')" accept="image/*" hidden>
            üì∏ –§–æ—Ç–æ
          </label>
          <label class="attach-btn">
            <input type="file" (change)="onFileSelected($event, 'text')" accept=".txt" hidden>
            üìÑ –¢–µ–∫—Å—Ç
          </label>
        </div>

        <div class="chips-container">
          @if (imageName) {
            <span class="file-chip">üñºÔ∏è {{ imageName }} <b (click)="removeFile('image')">√ó</b></span>
          }
          @if (textFileName) {
            <span class="file-chip">üìù {{ textFileName }} <b (click)="removeFile('text')">√ó</b></span>
          }
        </div>
      </div>
    </div>

    <div class="form-footer">
      <div class="captcha-styled">
        <div class="visual-code">{{ captchaCode }}</div>
        <input formControlName="captcha" placeholder="–ö–æ–¥">
        <button type="button" (click)="refreshCaptcha()">üîÑ</button>
      </div>

      <div class="actions">
        <button type="button" class="btn-preview" (click)="togglePreview()">
          {{ isPreview ? '–ü—Ä–∞–≤–∫–∞' : '–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä' }}
        </button>
        <button type="submit" class="btn-primary" [disabled]="commentForm.invalid">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </form>

  @if (isPreview && previewContent) {
    <div class="live-preview">
      <div class="preview-tag">–ü–†–ï–î–ü–†–û–°–ú–û–¢–†</div>
      <div class="preview-body" [innerHTML]="previewContent"></div>
    </div>
  }
</div>